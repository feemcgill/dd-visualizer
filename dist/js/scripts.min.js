"use strict";function mapRange(e,t,n,i,a){return(e-t)*(a-i)/(n-t)+i}function nowPLayingTicker(){TweenMax.to(tickerText,30,{x:-2e3,ease:Linear.easeNone,onComplete:function(){tickerText.x=app.renderer.width,nowPLayingTicker()}})}function snakeIntro(){for(var e=0;e<snakeSegs.length;e++)!function(e){TweenMax.to(snakeSegs[e],10,{width:app.renderer.width*((e+1)/snakeSegs.length),height:app.renderer.height*((e+1)/snakeSegs.length),delay:.7*e,onComplete:function(){e+1==snakeSegs.length&&(snakesReady=!0)}})}(e)}function swapTextures(){videoSprite.setTexture(videoSprite.texture==vidTex?vidTex2:vidTex);for(var e=0;e<snakeSegs.length;e++)!function(e){setTimeout(function(){snakeSegs[e].setTexture(snakeSegs[e].texture==vidTex?vidTex2:vidTex),e+1==snakeSegs.length&&setTimeout(function(){bgVidSprite.setTexture(bgVidSprite.texture==vidTex?vidTex2:vidTex)},100)},100*e)}(e)}function nextTrack(){audioKicking=!1;var e="./audio/"+tracks[trackIndex].url;trackIndex=(trackIndex+1)%tracks.length,window.fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return audioContext.decodeAudioData(e,function(e){trackBuffer=e},function(e){return console.error(e)})}).catch(function(e){console.error("oh noes!",e),dbg.append("<div>EXCEPTION</div>"),dbg.append(e)}).then(function(){dbg.append("<div>Try playing now</div>")})}function play(e){autioInitiated&&(trackSource.buffer=null),trackSource=audioContext.createBufferSource(),trackSource.buffer=e,trackSource.connect(audioContext.destination),trackSource.onended=function(e){nextTrack()},trackSource.start(),dbg.append("should start now"),audioKicking=!0,autioInitiated=!0,playCount>0?swapTextures():snakeIntro(),playCount++}function initAudio(){console.log("init audio");try{"undefined"!=typeof AudioContext?audioContext=new AudioContext:"undefined"!=typeof webkitAudioContext?audioContext=new webkitAudioContext:usingWebAudio=!1}catch(e){usingWebAudio=!1}if(analyser=audioContext.createAnalyser(),analyser.connect(audioContext.destination),analyser.fftSize=32,bufferLength=analyser.frequencyBinCount,dataArray=new Uint8Array(bufferLength),usingWebAudio&&"suspended"===audioContext.state){var e=function e(){audioContext.resume(),setTimeout(function(){"running"===audioContext.state&&document.body.removeEventListener("touchend",e,!1)},0)};document.body.addEventListener("touchend",e,!1)}nextTrack()}var count=0,tickerText="",snakeSegsReverse=void 0,snakesReady=!1,videoSprite=void 0,snakeSegs=void 0,bgVidSprite=void 0,vidTex=void 0,vidTex2=void 0,app=new PIXI.Application({width:window.innerWidth,height:window.innerHeight,backgroundColor:16777215});document.body.appendChild(app.view),PIXI.loader.add("fun","img/logo.png").load(function(e,t){vidTex=new PIXI.Texture.fromVideo("vid/vid1-w.mp4"),vidTex.baseTexture.source.loop=!0,vidTex.baseTexture.source.muted=!0,vidTex2=new PIXI.Texture.fromVideo("vid/froth-2.mp4"),vidTex2.baseTexture.source.loop=!0,vidTex2.baseTexture.source.muted=!0;var n=new PIXI.Graphics;n.beginFill(16777215,1),n.drawRect(0,0,window.innerWidth,window.innerHeight),n.endFill(),n.aplha=.4,n.interactive=!0,app.stage.addChild(n);var i=app.renderer.width,a=app.renderer.height,r=i/2,d=a/2;n.on("mousemove",function(e){var t=e;snakesReady&&TweenMax.staggerTo(snakeSegsReverse,10,{x:mapRange(t.data.global.x,0,app.renderer.width,r-170,r+170),y:mapRange(t.data.global.y,0,app.renderer.height,d-170,d+170)},.15);var n=mapRange(t.data.global.x,0,app.renderer.width,r+10,r-10),i=mapRange(t.data.global.y,0,app.renderer.height,d+10,d-10);TweenMax.to(s,2,{x:n,y:i})}),n.on("click",function(e){swapTextures()}),bgVidSprite=new PIXI.Sprite(vidTex),bgVidSprite.width=app.screen.width,bgVidSprite.height=app.screen.height,app.stage.addChild(bgVidSprite),videoSprite=new PIXI.Sprite(vidTex2),videoSprite.width=app.screen.width,videoSprite.height=app.screen.height;var o=new PIXI.Sprite;app.stage.addChild(o),snakeSegs=[];for(var u=6;u>0;u--){var c=new PIXI.Sprite(vidTex),p=new PIXI.Graphics;p.beginFill(16724736),p.drawCircle(0,0,100),p.endFill(),c.x=app.renderer.width/2,c.y=app.renderer.height/2,c.anchor.x=.5,c.anchor.y=.5,c.width=app.renderer.width,c.height=app.renderer.height,c.finalScale=u/6*5,c.width=0,c.height=0,c.alpha=.9,snakeSegs.push(c),o.addChild(c)}snakeSegsReverse=snakeSegs.reverse();var s=new PIXI.Sprite(t.fun.texture);s.x=app.renderer.width/2,s.y=app.renderer.height/2,s.scale.x=0,s.scale.y=0,s.anchor.x=.5,s.anchor.y=.5,app.stage.addChild(s),tickerText=new PIXI.Text("",{fontFamily:"SerifGothicStd-Bold",fontSize:36,fill:6710886,align:"left"}),app.stage.addChild(tickerText),tickerText.x=app.renderer.width/2,tickerText.y=app.renderer.height-50,tickerText.blendMode=PIXI.BLEND_MODES.ADD,tickerText.x=app.renderer.width,app.stage.addChild(videoSprite),videoSprite.mask=s;var l=new PIXI.Sprite;app.stage.addChild(l),l.x=100,l.y=100;for(var h=[],g=0;g<4;g++)for(var x=0;x<4;x++){var v=new PIXI.Sprite;v.width=40,v.height=40;var f=new PIXI.Graphics;f.beginFill(16777215),f.drawCircle(0,0,1),f.endFill(),v.x=100*g,v.y=100*x,v.x=i*g/4,v.y=a*x/4,v.alpha=.7,h.push(v),v.addChild(f)}app.ticker.add(function(){if(count+=.01,audioKicking){var e=mapRange(dataArray[10],0,255,.1,.3);analyser.getByteFrequencyData(dataArray),s.scale.x=e,s.scale.y=e;for(var t=0;t<h.length;t++){var n=h[t];n.scale.x=dataArray[t],n.scale.y=dataArray[t]}}})});var debug=!0,ddTracks=[{url:"White-Fence_To-the-Boy-I-Jumped-in-the-Hemlock-Alley.mp3",text:"To the Boy I Jumped in the Hemlock Alley by White Fence"},{url:"Tame-Impala_Yes-Im-Changing.mp3",text:"Yes I'm Changing by Tame Impala"},{url:"Mercury-Rev_Opus-40.mp3",text:"Opus 40 by Mercury Rev"}],testTracks=[{url:"1.mp3"},{url:"2.mp3"},{url:"3.mp3"}],dbg=null;$(document).ready(function(){dbg=$(".debug"),dbg.text("ios8"),debug&&dbg.show()});var tracks=ddTracks,trackIndex=0,audioKicking=!1,autioInitiated=!1,playCount=0,audioContext=null,usingWebAudio=!0,analyser=null,bufferLength=null,dataArray=null,viZdata=void 0,trackBuffer=void 0,trackSource=void 0,muted=!1;$(".play-it").click(function(){initAudio()}),$(".play-now").click(function(){play(trackBuffer)}),$(".mute-toggle").click(function(){muted?(trackSource.connect(analyser),$(this).text("mute")):(trackSource.disconnect(),$(this).text("unmute")),muted=!muted});