"use strict";function mapRange(e,t,a,r,n){return(e-t)*(n-r)/(a-t)+r}function nowPLayingTicker(){TweenMax.to(tickerText,30,{x:-2e3,ease:Linear.easeNone,onComplete:function(){tickerText.x=app.renderer.width,nowPLayingTicker()}})}function snakeIntro(){for(var e=0;e<snakeSegs.length;e++)!function(e){TweenMax.to(snakeSegs[e],10,{width:app.renderer.width*((e+1)/snakeSegs.length),height:app.renderer.height*((e+1)/snakeSegs.length),delay:.7*e,onComplete:function(){e+1==snakeSegs.length&&(snakesReady=!0)}})}(e)}function swapTextures(){videoSprite.setTexture(videoSprite.texture==vidTex?vidTex2:vidTex);for(var e=0;e<snakeSegs.length;e++)!function(e){setTimeout(function(){snakeSegs[e].setTexture(snakeSegs[e].texture==vidTex?vidTex2:vidTex),e+1==snakeSegs.length&&setTimeout(function(){bgVidSprite.setTexture(bgVidSprite.texture==vidTex?vidTex2:vidTex)},100)},100*e)}(e)}function nextTrack(){alert("init Next Track"),audioKicking=!1,trackIndex=(trackIndex+1)%tracks.length;var e="./audio/"+tracks[trackIndex].url;window.fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return audioContext.decodeAudioData(e)}).then(function(e){trackBuffer=e,setTimeout(function(){tickerText.text="NOW PLAYING: "+tracks[trackIndex].text,nowPLayingTicker()},3500),alert("got the track should play"),play(trackBuffer)})}function play(e){autioInitiated&&(trackSource.buffer=null),trackSource=audioContext.createBufferSource(),trackSource.buffer=e,trackSource.connect(analyser),trackSource.onended=function(e){nextTrack()},trackSource.start(),alert("should start now"),audioKicking=!0,autioInitiated=!0,playCount>0?swapTextures():snakeIntro(),playCount++}var count=0,tickerText="",snakeSegsReverse=void 0,snakesReady=!1,videoSprite=void 0,snakeSegs=void 0,bgVidSprite=void 0,vidTex=void 0,vidTex2=void 0,app=new PIXI.Application({width:window.innerWidth,height:window.innerHeight,backgroundColor:16777215});document.body.appendChild(app.view),PIXI.loader.add("fun","img/logo.png").load(function(e,t){vidTex=new PIXI.Texture.fromImage("img/logo.png"),vidTex.baseTexture.source.loop=!0,vidTex.baseTexture.source.muted=!0,vidTex2=new PIXI.Texture.fromImage("img/logo.png"),vidTex2.baseTexture.source.loop=!0,vidTex2.baseTexture.source.muted=!0;var a=new PIXI.Graphics;a.beginFill(16777215,1),a.drawRect(0,0,window.innerWidth,window.innerHeight),a.endFill(),a.aplha=.4,a.interactive=!0,app.stage.addChild(a);var r=app.renderer.width,n=app.renderer.height,i=r/2,d=n/2;a.on("mousemove",function(e){var t=e;snakesReady&&TweenMax.staggerTo(snakeSegsReverse,10,{x:mapRange(t.data.global.x,0,app.renderer.width,i-170,i+170),y:mapRange(t.data.global.y,0,app.renderer.height,d-170,d+170)},.15);var a=mapRange(t.data.global.x,0,app.renderer.width,i+10,i-10),r=mapRange(t.data.global.y,0,app.renderer.height,d+10,d-10);TweenMax.to(p,2,{x:a,y:r})}),a.on("click",function(e){swapTextures()}),bgVidSprite=new PIXI.Sprite(vidTex),bgVidSprite.width=app.screen.width,bgVidSprite.height=app.screen.height,app.stage.addChild(bgVidSprite),videoSprite=new PIXI.Sprite(vidTex2),videoSprite.width=app.screen.width,videoSprite.height=app.screen.height;var o=new PIXI.Sprite;app.stage.addChild(o),snakeSegs=[];for(var u=6;u>0;u--){var c=new PIXI.Sprite(vidTex),s=new PIXI.Graphics;s.beginFill(16724736),s.drawCircle(0,0,100),s.endFill(),c.x=app.renderer.width/2,c.y=app.renderer.height/2,c.anchor.x=.5,c.anchor.y=.5,c.width=app.renderer.width,c.height=app.renderer.height,c.finalScale=u/6*5,c.width=0,c.height=0,c.alpha=.9,snakeSegs.push(c),o.addChild(c)}snakeSegsReverse=snakeSegs.reverse();var p=new PIXI.Sprite(t.fun.texture);p.x=app.renderer.width/2,p.y=app.renderer.height/2,p.scale.x=0,p.scale.y=0,p.anchor.x=.5,p.anchor.y=.5,app.stage.addChild(p),tickerText=new PIXI.Text("",{fontFamily:"SerifGothicStd-Bold",fontSize:36,fill:6710886,align:"left"}),app.stage.addChild(tickerText),tickerText.x=app.renderer.width/2,tickerText.y=app.renderer.height-50,tickerText.blendMode=PIXI.BLEND_MODES.ADD,tickerText.x=app.renderer.width,app.stage.addChild(videoSprite),videoSprite.mask=p;var l=new PIXI.Sprite;app.stage.addChild(l),l.x=100,l.y=100;for(var h=[],g=0;g<4;g++)for(var x=0;x<4;x++){var k=new PIXI.Sprite;k.width=40,k.height=40;var v=new PIXI.Graphics;v.beginFill(16777215),v.drawCircle(0,0,1),v.endFill(),k.x=100*g,k.y=100*x,k.x=r*g/4,k.y=n*x/4,k.alpha=.7,h.push(k),k.addChild(v)}app.ticker.add(function(){if(count+=.01,audioKicking){var e=mapRange(dataArray[10],0,255,.1,.3);analyser.getByteFrequencyData(dataArray),p.scale.x=e,p.scale.y=e;for(var t=0;t<h.length;t++){var a=h[t];a.scale.x=dataArray[t],a.scale.y=dataArray[t]}}})});var ddTracks=[{url:"White-Fence_To-the-Boy-I-Jumped-in-the-Hemlock-Alley.mp3",text:"To the Boy I Jumped in the Hemlock Alley by White Fence"},{url:"Tame-Impala_Yes-Im-Changing.mp3",text:"Yes I'm Changing by Tame Impala"},{url:"Mercury-Rev_Opus-40.mp3",text:"Opus 40 by Mercury Rev"}],testTracks=[{url:"1.mp3"},{url:"2.mp3"},{url:"3.mp3"}],tracks=testTracks,trackIndex=0,audioKicking=!1,autioInitiated=!1,playCount=0;alert("ios 5");var audioContext=null,usingWebAudio=!0;try{"undefined"!=typeof AudioContext?audioContext=new AudioContext:"undefined"!=typeof webkitAudioContext?audioContext=new webkitAudioContext:usingWebAudio=!1}catch(e){usingWebAudio=!1}alert(usingWebAudio);var analyser=audioContext.createAnalyser();analyser.connect(audioContext.destination),analyser.fftSize=32;var bufferLength=analyser.frequencyBinCount,dataArray=new Uint8Array(bufferLength),viZdata=void 0,trackBuffer=void 0,trackSource=void 0;if(nextTrack(),usingWebAudio&&"suspended"===audioContext.state){var resume=function e(){audioContext.resume(),setTimeout(function(){"running"===audioContext.state&&document.body.removeEventListener("touchend",e,!1)},0)};document.body.addEventListener("touchend",resume,!1)}var muted=!1;$(".mute-toggle").click(function(){muted?(trackSource.connect(analyser),$(this).text("mute")):(trackSource.disconnect(),$(this).text("unmute")),muted=!muted});