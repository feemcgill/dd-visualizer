"use strict";function mapRange(e,t,a,r,i){return(e-t)*(i-r)/(a-t)+r}function nowPLayingTicker(){TweenMax.to(tickerText,30,{x:-2e3,ease:Linear.easeNone,onComplete:function(){tickerText.x=app.renderer.width,nowPLayingTicker()}})}function swapTextures(){videoSprite.setTexture(videoSprite.texture==vidTex?vidTex2:vidTex);for(var e=0;e<snakeSegs.length;e++)!function(e){setTimeout(function(){snakeSegs[e].setTexture(snakeSegs[e].texture==vidTex?vidTex2:vidTex),e+1==snakeSegs.length&&setTimeout(function(){bgVidSprite.setTexture(bgVidSprite.texture==vidTex?vidTex2:vidTex)},100)},100*e)}(e)}function nextTrack(){audioKicking=!1,trackIndex=(trackIndex+1)%tracks.length;var e="./audio/"+tracks[trackIndex].url;window.fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return audioContext.decodeAudioData(e)}).then(function(e){trackBuffer=e,setTimeout(function(){tickerText.text="NOW PLAYING: "+tracks[trackIndex].text,nowPLayingTicker()},3500),play(trackBuffer)})}function play(e){autioInitiated&&(trackSource.buffer=null),trackSource=audioContext.createBufferSource(),trackSource.buffer=e,trackSource.connect(analyser),trackSource.onended=function(e){nextTrack()},trackSource.start(),audioKicking=!0,autioInitiated=!0,playCount>0&&swapTextures(),playCount++}var count=0,tickerText="",snakeSegsReverse=void 0,snakesReady=!1,videoSprite=void 0,snakeSegs=void 0,bgVidSprite=void 0,vidTex=void 0,vidTex2=void 0,app=new PIXI.Application({width:window.innerWidth,height:window.innerHeight,backgroundColor:16777215});document.body.appendChild(app.view),PIXI.loader.add("fun","img/logo.png").load(function(e,t){function a(){for(var e=0;e<snakeSegs.length;e++)!function(e){TweenMax.to(snakeSegs[e],10,{width:app.renderer.width*((e+1)/p),height:app.renderer.height*((e+1)/p),delay:.7*e,onComplete:function(){e+1==snakeSegs.length&&(snakesReady=!0)}})}(e)}vidTex=new PIXI.Texture.fromVideo("vid/vid1-w.mp4"),vidTex.baseTexture.source.loop=!0,vidTex.baseTexture.source.muted=!0,vidTex2=new PIXI.Texture.fromVideo("vid/froth-2.mp4"),vidTex2.baseTexture.source.loop=!0,vidTex2.baseTexture.source.muted=!0;var r=new PIXI.Graphics;r.beginFill(16777215,1),r.drawRect(0,0,window.innerWidth,window.innerHeight),r.endFill(),r.aplha=.4,r.interactive=!0,app.stage.addChild(r);var i=app.renderer.width,n=app.renderer.height,d=i/2,o=n/2;r.on("mousemove",function(e){var t=e;snakesReady&&TweenMax.staggerTo(snakeSegsReverse,10,{x:mapRange(t.data.global.x,0,app.renderer.width,d-170,d+170),y:mapRange(t.data.global.y,0,app.renderer.height,o-170,o+170)},.15);var a=mapRange(t.data.global.x,0,app.renderer.width,d+10,d-10),r=mapRange(t.data.global.y,0,app.renderer.height,o+10,o-10);TweenMax.to(l,2,{x:a,y:r})}),r.on("click",function(e){swapTextures()}),bgVidSprite=new PIXI.Sprite(vidTex),bgVidSprite.width=app.screen.width,bgVidSprite.height=app.screen.height,app.stage.addChild(bgVidSprite),videoSprite=new PIXI.Sprite(vidTex2),videoSprite.width=app.screen.width,videoSprite.height=app.screen.height;var c=new PIXI.Sprite;app.stage.addChild(c),snakeSegs=[];for(var p=6,u=p;u>0;u--){var s=new PIXI.Sprite(vidTex),h=new PIXI.Graphics;h.beginFill(16724736),h.drawCircle(0,0,100),h.endFill(),s.x=app.renderer.width/2,s.y=app.renderer.height/2,s.anchor.x=.5,s.anchor.y=.5,s.width=app.renderer.width,s.height=app.renderer.height,s.finalScale=u/p*5,s.width=0,s.height=0,s.alpha=.9,snakeSegs.push(s),c.addChild(s)}snakeSegsReverse=snakeSegs.reverse(),setTimeout(function(){a()},6e3);var l=new PIXI.Sprite(t.fun.texture);l.x=app.renderer.width/2,l.y=app.renderer.height/2,l.scale.x=0,l.scale.y=0,l.anchor.x=.5,l.anchor.y=.5,app.stage.addChild(l),tickerText=new PIXI.Text("",{fontFamily:"SerifGothicStd-Bold",fontSize:36,fill:6710886,align:"left"}),app.stage.addChild(tickerText),tickerText.x=app.renderer.width/2,tickerText.y=app.renderer.height-50,tickerText.blendMode=PIXI.BLEND_MODES.ADD,tickerText.x=app.renderer.width,app.stage.addChild(videoSprite),videoSprite.mask=l;var x=new PIXI.Sprite;app.stage.addChild(x),x.x=100,x.y=100;for(var g=[],v=0;v<4;v++)for(var k=0;k<4;k++){var T=new PIXI.Sprite;T.width=40,T.height=40;var f=new PIXI.Graphics;f.beginFill(16777215),f.drawCircle(0,0,1),f.endFill(),T.x=100*v,T.y=100*k,T.x=i*v/4,T.y=n*k/4,T.alpha=.7,g.push(T),T.addChild(f)}app.ticker.add(function(){if(count+=.01,audioKicking){var e=mapRange(dataArray[10],0,255,.1,.3);analyser.getByteFrequencyData(dataArray),l.scale.x=e,l.scale.y=e;for(var t=0;t<g.length;t++){var a=g[t];a.scale.x=dataArray[t],a.scale.y=dataArray[t]}}})});var ddTracks=[{url:"White-Fence_To-the-Boy-I-Jumped-in-the-Hemlock-Alley.mp3",text:"To the Boy I Jumped in the Hemlock Alley by White Fence"},{url:"Tame-Impala_Yes-Im-Changing.mp3",text:"Yes I'm Changing by Tame Impala"},{url:"Mercury-Rev_Opus-40.mp3",text:"Opus 40 by Mercury Rev"}],testTracks=[{url:"1.mp3"},{url:"2.mp3"},{url:"3.mp3"}],tracks=ddTracks,trackIndex=0,audioKicking=!1,autioInitiated=!1,playCount=0,audioContext=new AudioContext,analyser=audioContext.createAnalyser();analyser.connect(audioContext.destination),analyser.fftSize=32;var bufferLength=analyser.frequencyBinCount,dataArray=new Uint8Array(bufferLength),viZdata=void 0,trackBuffer=void 0,trackSource=void 0;nextTrack();var muted=!1;$(".mute-toggle").click(function(){muted?(trackSource.connect(analyser),$(this).text("mute")):(trackSource.disconnect(),$(this).text("unmute")),muted=!muted});