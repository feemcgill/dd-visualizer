"use strict";function mapRange(e,t,i,n,r){return(e-t)*(r-n)/(i-t)+n}function nowPLayingTicker(){TweenMax.to(tickerText,30,{x:-2e3,ease:Linear.easeNone,onComplete:function(){tickerText.x=app.renderer.width,nowPLayingTicker()}})}function snakeIntro(){nowPLayingTicker(),TweenMax.to(logo,5,{alpha:1});for(var e=0;e<snakeSegs.length;e++)!function(e){TweenMax.to(snakeSegs[e],10,{width:app.renderer.width*((e+1)/snakeSegs.length),height:app.renderer.height*((e+1)/snakeSegs.length),delay:.7*e,onComplete:function(){e+1==snakeSegs.length&&(snakesReady=!0)}})}(e)}function snakeCenter(){for(var e=0;e<snakeSegs.length;e++)TweenMax.to(snakeSegs[e],.1,{width:app.renderer.width*((e+1)/snakeSegs.length),height:app.renderer.height*((e+1)/snakeSegs.length),x:app.renderer.width/2,y:app.renderer.height/2,delay:.1*e})}function swapTextures(){videoSprite.setTexture(videoSprite.texture==vidTex?vidTex2:vidTex);for(var e=0;e<snakeSegs.length;e++)!function(e){setTimeout(function(){snakeSegs[e].setTexture(snakeSegs[e].texture==vidTex?vidTex2:vidTex),e+1==snakeSegs.length&&setTimeout(function(){bgVidSprite.setTexture(bgVidSprite.texture==vidTex?vidTex2:vidTex)},100)},100*e)}(e)}function getWindowSize(){return{width:window.innerWidth,height:window.innerHeight}}function sizeIt(){var e=getWindowSize(),t=e.width,i=e.height;app.renderer.view.style.width=t+"px",app.renderer.view.style.height=i+"px",app.renderer.resize(t,i),bigRect.width=t,bigRect.height=i,bgVidSprite.width=t,bgVidSprite.height=i,videoSprite.width=t,videoSprite.height=i,logo.x=t/2,logo.y=i/2,tickerText.y=i-50,snakeCenter()}function nextTrack(){audioKicking=!1;var e="https://cors.now.sh/https://s3-us-west-2.amazonaws.com/ddaze-visualizer/dd18mix/"+tracks[trackIndex].url;window.fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return audioContext.decodeAudioData(e,function(e){trackBuffer=e},function(e){return console.error(e)})}).catch(function(e){console.error("oh noes!",e),dbg.append("<div>EXCEPTION</div>"),dbg.append(e)}).then(function(){audioKicking||(audioKicking=!0,$(".loading").hide(),$(".play-it").show()),dbg.append("<div>Next Track Loaded</div>"),trackIndex=(trackIndex+1)%tracks.length})}function updateTicker(e){tickerText.text="NOW PLAYING: "+e}function play(e){autioInitiated&&(trackSource.buffer=null),trackSource=audioContext.createBufferSource(),trackSource.buffer=e,trackSource.connect(analyser),trackSource.onended=function(e){play(trackBuffer)},trackSource.start(),dbg.append("<div>Playing New Track</div>"),autioInitiated=!0,playCount>0?swapTextures():snakeIntro(),updateTicker(tracks[playingIndex].text),playingIndex=(playingIndex+1)%tracks.length,playCount++,nextTrack()}function initAudio(e){try{"undefined"!=typeof AudioContext?audioContext=new AudioContext:"undefined"!=typeof webkitAudioContext?audioContext=new webkitAudioContext:usingWebAudio=!1}catch(e){usingWebAudio=!1}if(usingWebAudio&&"suspended"===audioContext.state){var t=function e(){audioContext.resume(),setTimeout(function(){"running"===audioContext.state&&document.body.removeEventListener("touchend",e,!1)},0)};document.body.addEventListener("touchend",t,!1)}analyser=audioContext.createAnalyser(),analyser.connect(audioContext.destination),analyser.fftSize=32,bufferLength=analyser.frequencyBinCount,dataArray=new Uint8Array(bufferLength),e()}var count=0,tickerText="",snakeSegsReverse=void 0,snakesReady=!1,videoSprite=void 0,snakeSegs=void 0,bgVidSprite=void 0,vidTex=void 0,vidTex2=void 0,logo=void 0,bigRect=void 0,app=new PIXI.Application({width:window.innerWidth,height:window.innerHeight,backgroundColor:16777215});document.body.appendChild(app.view),PIXI.loader.add("fun","img/logo.png").load(function(e,t){vidTex=new PIXI.Texture.fromVideo("vid/vid1-w.mp4"),vidTex.baseTexture.source.loop=!0,vidTex.baseTexture.source.muted=!0,vidTex2=new PIXI.Texture.fromVideo("vid/froth-2.mp4"),vidTex2.baseTexture.source.loop=!0,vidTex2.baseTexture.source.muted=!0,bigRect=new PIXI.Graphics,bigRect.beginFill(16777215,1),bigRect.drawRect(0,0,window.innerWidth,window.innerHeight),bigRect.endFill(),bigRect.alpha=0,bigRect.interactive=!0;var i=app.renderer.width,n=app.renderer.height,r=i/2,a=n/2;bigRect.on("mousemove",function(e){var t=e;snakesReady&&TweenMax.staggerTo(snakeSegsReverse,10,{x:mapRange(t.data.global.x,0,app.renderer.width,r-170,r+170),y:mapRange(t.data.global.y,0,app.renderer.height,a-170,a+170)},.15)}),bigRect.on("click",function(e){swapTextures()}),bgVidSprite=new PIXI.Sprite(vidTex),bgVidSprite.width=app.screen.width,bgVidSprite.height=app.screen.height,app.stage.addChild(bgVidSprite),videoSprite=new PIXI.Sprite(vidTex2),videoSprite.width=app.screen.width,videoSprite.height=app.screen.height;var o=new PIXI.Sprite;app.stage.addChild(o),snakeSegs=[];for(var d=6;d>0;d--){var u=new PIXI.Sprite(vidTex),l=new PIXI.Graphics;l.beginFill(16724736),l.drawCircle(0,0,100),l.endFill(),u.x=app.renderer.width/2,u.y=app.renderer.height/2,u.anchor.x=.5,u.anchor.y=.5,u.width=app.renderer.width,u.height=app.renderer.height,u.finalScale=d/6*5,u.width=0,u.height=0,u.alpha=.9,snakeSegs.push(u),o.addChild(u)}snakeSegsReverse=snakeSegs.reverse(),logo=new PIXI.Sprite(t.fun.texture),logo.x=app.renderer.width/2,logo.y=app.renderer.height/2,logo.scale.x=0,logo.scale.y=0,logo.anchor.x=.5,logo.anchor.y=.5,logo.alpha=0,app.stage.addChild(logo),tickerText=new PIXI.Text("",{fontFamily:"SerifGothicStd-Bold",fontSize:36,fill:6710886,align:"left"}),app.stage.addChild(tickerText),tickerText.x=app.renderer.width/2,tickerText.y=app.renderer.height-50,tickerText.blendMode=PIXI.BLEND_MODES.ADD,tickerText.x=app.renderer.width,app.stage.addChild(videoSprite),videoSprite.mask=logo,app.stage.addChild(bigRect),app.ticker.add(function(){if(count+=.01,audioKicking){var e=mapRange(dataArray[10],0,255,.1,.3);analyser.getByteFrequencyData(dataArray),logo.scale.x=e,logo.scale.y=e}})}),function(e,t){var i=function(e,t,i){var n;return function(){function r(){i||e.apply(a,o),n=null}var a=this,o=arguments;n?clearTimeout(n):i&&e.apply(a,o),n=setTimeout(r,t||50)}};jQuery.fn[t]=function(e){return e?this.bind("resize",i(e)):this.trigger(t)}}(jQuery,"smartresize"),jQuery(window).smartresize(function(){sizeIt()});var debug=!1,ddTracks=[{text:"A Place To Bury Strangers - Never Coming Back",url:"A+Place+To+Bury+Strangers+-+Never+Coming+Back.mp3"},{text:"All Them Witches - Alabaster",url:"All+Them+Witches+-+Alabaster.mp3"},{text:"CHELSEA WOLFE - Offering",url:"CHELSEA+WOLFE+-+Offering.mp3"},{text:"Can -  Little Star of Bethlehem",url:"Can+-++Little+Star+of+Bethlehem.mp3"},{text:"Connan Mockasin - It_s Choade My Dear",url:"Connan+Mockasin+-+It_s+Choade+My+Dear.mp3"},{text:"Cut Worms - Cash for Gold",url:"Cut+Worms+-+Cash+for+Gold.mp3"},{text:"DakhaBrakha - Kolyskova",url:"DakhaBrakha+-+Kolyskova.mp3"},{text:"Death Grips - Eh",url:"Death+Grips+-+Eh.mp3"},{text:"Ex-Cult - New Face On",url:"Ex-Cult+-+New+Face+On.mp3"},{text:"Gladys Lazer - SW Georgia",url:"Gladys+Lazer+-+SW+Georgia.mp3"},{text:"Here Lies Man - I stand Alone",url:"Here+Lies+Man+-+I+stand+Alone.mp3"},{text:"Kevin Morby - Tin Can",url:"Kevin+Morby+-+Tin+Can.mp3"},{text:"Kikagaku Moyo - Green Sugar",url:"Kikagaku+Moyo+-+Green+Sugar.mp3"},{text:"King Khan _ The Shrines - I Wanna Be a Girl",url:"King+Khan+_+The+Shrines+-+I+Wanna+Be+a+Girl.mp3"},{text:"Mary Lattimore - Hello From the Edge of the Earth",url:"Mary+Lattimore+-+Hello+From+the+Edge+of+the+Earth.mp3"},{text:"Mercury Rev - Opus 40",url:"Mercury+Rev+-+Opus+40.mp3"},{text:"Pond - Paint Me Silver",url:"Pond+-+Paint+Me+Silver.mp3"},{text:"Preoccupations - Zodiac",url:"Preoccupations+-+Zodiac.mp3"},{text:"Sextile - Ripped",url:"Sextile+-+Ripped.mp3"},{text:"Shannon _ The Clams - I Leave Again",url:"Shannon+_+The+Clams+-+I+Leave+Again.mp3"},{text:"The Holydrug Couple - If I Could Find You (Eternity)",url:"The+Holydrug+Couple+-+If+I+Could+Find+You+(Eternity).mp3"},{text:"Tropa Magica - LSD Roma",url:"Tropa+Magica+-+LSD+Roma.mp3"},{text:"True Widow - Skull Eyes",url:"True+Widow+-+Skull+Eyes.mp3"},{text:"Ty Segall -  Every 1_s a Winner",url:"Ty+Segall+-++Every+1_s+a+Winner.mp3"},{text:"Ulrika Spacek - Ornament",url:"Ulrika+Spacek+-+Ornament.mp3"},{text:"Warpaint - Above Control",url:"Warpaint+-+Above+Control.mp3"},{text:"White Fence - To the Boy I Jumped in the Hemlock Alley",url:"White+Fence+-+To+the+Boy+I+Jumped+in+the+Hemlock+Alley.mp3"}],testTracks=[{url:"1.mp3"},{url:"2.mp3"},{url:"3.mp3"}],dbg=null;$(document).ready(function(){dbg=$(".debug"),dbg.text("ios9"),debug&&dbg.show()});var tracks=ddTracks,trackIndex=0,audioKicking=!1,autioInitiated=!1,playCount=0,audioContext=null,usingWebAudio=!0,analyser=null,bufferLength=null,dataArray=null,viZdata=void 0,trackBuffer=void 0,trackSource=void 0,playingIndex=0;initAudio(nextTrack);var muted=!1;$(".play-it").click(function(e){e.preventDefault(),play(trackBuffer),debug||$(".loading-screen").remove()}),$(".mute-toggle").click(function(){muted?(trackSource.connect(analyser),$(this).text("mute")):(trackSource.disconnect(),$(this).text("unmute")),muted=!muted});